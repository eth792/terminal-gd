# OCR Match Core - 项目状态

**最后更新**: 2025-11-14 00:15
**当前版本**: v0.1.6 (P2优化与提取逻辑诊断)
**失败版本**: v0.1.7 (提取逻辑修复尝试) - ❌ 灾难性回归，已回滚
**下一版本**: v0.1.7-retry (提取逻辑修复重试) - 待规划

---

## 🚀 Quick Start for New Sessions

**目的**: 快速恢复项目上下文，找到需要的信息

### Step 1: Read This File
**当前位置**: `docs/PROJECT_STATUS.md` - 项目状态仪表盘

**核心内容**:
- ✅ 当前 KPI 和版本状态（见下方"核心指标"表格）
- ✅ 最近完成的工作和失败尝试（见"项目路线图"）
- ✅ 下一步计划和优先级（见"进行中"和"待完成"）

### Step 2: Check Related Docs

**深入了解时，按需阅读**：

- **版本历史和技术洞察** → [implementation_record.md](implementation_record.md)
  - 完整版本演进记录（v0.1.0 → 当前版本）
  - 每个版本的代码变更、测试结果、技术决策
  - 关键指标演进图表

- **测试运行指南** → [TEST_GUIDE.md](TEST_GUIDE.md)
  - 标准化测试脚本使用方法（`test:full` / `test:quick` / `test:custom`）
  - CLI 参数详解和调优建议
  - 版本发布测试流程

- **版本发布流程** → [../analysis/docs-flow-automation/RELEASE_WORKFLOW.md](../analysis/docs-flow-automation/RELEASE_WORKFLOW.md)
  - 阶段 0-5 完整发布流程
  - 文档更新 Checklist
  - 常见遗漏提醒

- **技术决策记录** → [TECHNICAL_DECISIONS.md](TECHNICAL_DECISIONS.md)
  - 核心架构决策（Monorepo/配置版本化/运行包结构）
  - 设计约束和原因
  - 版本演进教训

### Step 3: Verify Environment

**环境检查**（如需执行代码）：

```bash
# 1. 检查 Git 分支
git branch --show-current

# 2. 查看最新代码变更
git log --oneline -3

# 3. 检查当前版本的核心代码
cat packages/ocr-match-core/src/bucket/bucketize.ts | head -100

# 4. 查看最新运行包（如有）
ls -lt runs/ | head -5
```

---

## 📊 当前状态快照

### 核心指标（v0.1.6 实际）

| 指标 | 数值 | vs Baseline | 目标 (v0.2.0) |
|------|------|-------------|---------------|
| **自动通过率** | **32.0%** | +789% (8.89x) | 40-45% |
| Exact | 71 / 222 | +63 (+789%) | 80-90 |
| Review | 25 / 222 | -55 (-68.8%) | 30-40 |
| Fail | 126 / 222 | -8 (-6.0%) | 90-100 |

### 版本历史

| 版本 | 发布日期 | 自动通过率 | 关键改进 | 文档链接 |
|------|---------|-----------|---------|---------|
| v0.1.0 | 2025-11-10 | 3.6% | 核心流程 | - |
| v0.1.1 | 2025-11-11 | 3.6% | 后处理清洗 | - |
| v0.1.2 | 2025-11-12 | 3.6% | 多文件DB索引 | - |
| v0.1.3 | 2025-11-13 | 3.6% | 标点归一化 | [详情](../analysis/archived/) |
| v0.1.4 | 2025-11-13 | 27.5% | 高置信度旁路 | [P0-Fix报告](../analysis/v0.1.4/P0_fix_report.md) |
| v0.1.5 | 2025-11-13 | 31.5% | 项目优先策略 | [实测报告](../analysis/v0.1.5/v0.1.5_实测报告.md) |
| **v0.1.6** | **2025-11-13** | **32.0%** | **Rule 3.5调整+提取逻辑诊断** | **[实测报告](../analysis/v0.1.6/v0.1.6_实测报告.md)** |
| ❌ v0.1.7 | 2025-11-14 | 0.0% | ❌ 提取逻辑修复失败（已回滚） | [失败分析](../analysis/v0.1.7/v0.1.7_failure_analysis.md) |

---

## 🗺️ 项目路线图

### ✅ 已完成

#### Phase 0: 核心流程 (v0.1.0-v0.1.2)
- [x] 四阶段处理管线（normalize → extract → match → bucketize）
- [x] 三级匹配策略（fast-exact → anchor → recall+rank）
- [x] 多文件DB索引支持
- [x] 运行包结构（manifest/results/summary/log）

#### Phase 1: P0优化 (v0.1.3-v0.1.4)
- [x] 标点符号归一化
- [x] 后处理字段清洗
- [x] **修复分桶逻辑设计缺陷**（高置信度旁路）
- [x] 自动通过率提升 7.6倍 (3.6% → 27.5%)

#### Phase 2: P1优化 (v0.1.5)
- [x] 深度失败分析（7个案例）
- [x] DB流程验证（确认无问题）
- [x] Excel多sheet处理说明
- [x] **实施"项目优先"策略**（Rule 3.5）
- [x] **降低高置信度f2_score阈值**（Rule 5）
- [x] 完整测试验证
- [x] 发布v0.1.5

**实际成果**:
- Exact: 61 → **70** (+9, +14.8%)
- Review: 27 → **25** (-2, -7.4%)
- Fail: 134 → **127** (-7, -5.2%)
- **自动通过率**: 27.5% → **31.5%** (+1.15倍)

#### Phase 3: P2优化与提取逻辑诊断 (v0.1.6)
- [x] 调整 Rule 3.5 约束（f2_score: 0.80→0.75, f1上界: 0.60→0.65）
- [x] OCR 归一化补充（"工理"→"工程"）
- [x] 目标测试策略验证（节省 12-15 小时）
- [x] **发现关键问题**: 50% 失败案例源于提取逻辑错误
- [x] 发布 v0.1.6

**实际成果** (完整测试):
- Exact: 70 → **71** (+1, +1.4%)
- Review: 25 → **25** (0, 0%)
- Fail: 127 → **126** (-1, -0.8%)
- **自动通过率**: 31.5% → **32.0%** (+0.5%)
- **测试耗时**: 36.6 分钟
- **关键发现**: 提取逻辑错误影响 21 个案例（预期修复后 +5-7% 自动通过率）

---

### ❌ 失败尝试

#### Phase 4: 提取逻辑修复 (v0.1.7) - **失败，已回滚** ❌

**版本状态**: ❌ 灾难性回归，完全失败

**实施任务（已完成但失败）**：
- [x] 清理 label_alias.json 配置污染
- [x] 修复标签匹配子串误匹配（添加分隔符检查）
- [x] 实施跨字段标签排除机制
- [x] 移除续行拼接的 endsWithEntity 误判
- [x] 运行完整测试（222 样本）
- [x] 创建失败分析报告

**实际成果（完整测试）**:
- 自动通过率：32.0% → **0.0%** (-32.0%, **-100%**)
- Exact: 71 → **0** (-71, -100%)
- FIELD_SIM_LOW_SUPPLIER: 21 → **121** (+100, +476%)
- EXTRACT_EMPTY_SUPPLIER: 0 → **27** (新增)
- **测试耗时**: 53.8 分钟

**失败原因**:
1. 移除 endsWithEntity 导致过度拼接（供应商名称与工程名称合并）
2. 分隔符检查过严（导致 27 个提取失败）
3. 跨字段排除不完整（无法检测不带标签的内容）
4. 配置清理未经验证（移除了可能有效的标签）

**关键教训**:
- ✅ 不要一次修改多个关键逻辑
- ✅ endsWithEntity 是内容特征检测，不是"Bug"
- ✅ 必须使用增量测试验证每个修改
- ✅ 配置清理需要基于实际 OCR 文本分析

**详细文档**: [失败分析报告](../analysis/v0.1.7/v0.1.7_failure_analysis.md)

---

### 🔥 进行中

**当前状态**: 回归 v0.1.6 基线，重新规划提取逻辑修复策略

**下一步**: 采用保守的增量优化策略，逐个验证每个修改点的有效性

---

### 📋 待完成

#### Phase 5: 长期优化 (v0.2.0+)
- [ ] 多sheet Excel完整支持
- [ ] review.html单页审查器
- [ ] results_top3.csv输出
- [ ] 配置训练工具

## 📝 文档生成说明

<!-- ⚠️ AUTOGENERATED SECTION - DO NOT EDIT MANUALLY -->
<!-- 此文档由 `npm run update-docs` 和 `npm run release` 自动更新 -->
<!-- 仅需手动更新路线图和未来计划 -->

**此文档的以下内容会自动生成：**
- 顶部元数据（最后更新、当前版本、下一版本）
- 核心指标表格（Exact/Review/Fail 数值）
- 版本历史表格（新版本行自动追加）

**以下内容需要手动维护：**
- 项目路线图状态和进度
- 失败尝试的详细分析
- 当前状态和下一步计划

## 📁 文档导航

**主要文档**：
- [implementation_record.md](implementation_record.md) - 完整版本历史和技术洞察
- [CLAUDE.md](../CLAUDE.md) - 快速状态恢复和发布工作流

**分析报告**：
- [analysis/v0.1.6/v0.1.6_实测报告.md](../analysis/v0.1.6/v0.1.6_实测报告.md) - v0.1.6 详细测试报告
- [analysis/v0.1.7/v0.1.7_failure_analysis.md](../analysis/v0.1.7/v0.1.7_failure_analysis.md) - v0.1.7 失败分析报告
- [analysis/v0.1.4/](../analysis/v0.1.4/) - v0.1.4 分析报告（P0-Fix、深度失败分析、DB验证等）

---

## 🚀 快速开始（新Session）

如果context被compact或新开session，按以下步骤恢复：

### 1. 读取当前状态
```bash
cat docs/PROJECT_STATUS.md
```

### 2. 定位当前版本
查看"🗺️ 项目路线图" → "🔥 进行中"

### 3. 读取详细计划
```bash
cat analysis/v0.1.5/plan.md
```

### 4. 检查最新代码
```bash
git log --oneline -3
git diff HEAD~1 packages/ocr-match-core/src/bucket/bucketize.ts
```

---

**最后更新**: 2025-11-14 00:15 | **项目负责人**: Caron | **技术实施**: Claude Code
