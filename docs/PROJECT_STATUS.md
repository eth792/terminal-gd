# OCR Match Core - 项目状态

**最后更新**: 2025-11-13 23:30
**当前版本**: v0.1.6 (P2优化与提取逻辑诊断)
**进行中版本**: v0.1.7 (提取逻辑根本缺陷修复) - 🔥 规划已提交
**下一版本**: v0.1.8 (文档字段黑名单) - 计划中

---

## 📊 当前状态快照

### 核心指标（v0.1.6 实际）

| 指标 | 数值 | vs Baseline | 目标 (v0.2.0) |
|------|------|-------------|---------------|
| **自动通过率** | **32.0%** | +789% (8.89x) | 40-45% |
| Exact | 71 / 222 | +63 (+789%) | 80-90 |
| Review | 25 / 222 | -55 (-68.8%) | 30-40 |
| Fail | 126 / 222 | -8 (-6.0%) | 90-100 |

### 版本历史

| 版本 | 发布日期 | 自动通过率 | 关键改进 | 文档链接 |
|------|---------|-----------|---------|---------|
| v0.1.0 | 2025-11-10 | 3.6% | 核心流程 | - |
| v0.1.1 | 2025-11-11 | 3.6% | 后处理清洗 | - |
| v0.1.2 | 2025-11-12 | 3.6% | 多文件DB索引 | - |
| v0.1.3 | 2025-11-13 | 3.6% | 标点归一化 | [详情](../analysis/archived/) |
| v0.1.4 | 2025-11-13 | 27.5% | 高置信度旁路 | [P0-Fix报告](../analysis/v0.1.4/P0_fix_report.md) |
| v0.1.5 | 2025-11-13 | 31.5% | 项目优先策略 | [实测报告](../analysis/v0.1.5/v0.1.5_实测报告.md) |
| **v0.1.6** | **2025-11-13** | **32.0%** | **Rule 3.5调整+提取逻辑诊断** | **[实测报告](../analysis/v0.1.6/v0.1.6_实测报告.md)** |

---

## 🗺️ 项目路线图

### ✅ 已完成

#### Phase 0: 核心流程 (v0.1.0-v0.1.2)
- [x] 四阶段处理管线（normalize → extract → match → bucketize）
- [x] 三级匹配策略（fast-exact → anchor → recall+rank）
- [x] 多文件DB索引支持
- [x] 运行包结构（manifest/results/summary/log）

#### Phase 1: P0优化 (v0.1.3-v0.1.4)
- [x] 标点符号归一化
- [x] 后处理字段清洗
- [x] **修复分桶逻辑设计缺陷**（高置信度旁路）
- [x] 自动通过率提升 7.6倍 (3.6% → 27.5%)

#### Phase 2: P1优化 (v0.1.5)
- [x] 深度失败分析（7个案例）
- [x] DB流程验证（确认无问题）
- [x] Excel多sheet处理说明
- [x] **实施"项目优先"策略**（Rule 3.5）
- [x] **降低高置信度f2_score阈值**（Rule 5）
- [x] 完整测试验证
- [x] 发布v0.1.5

**实际成果**:
- Exact: 61 → **70** (+9, +14.8%)
- Review: 27 → **25** (-2, -7.4%)
- Fail: 134 → **127** (-7, -5.2%)
- **自动通过率**: 27.5% → **31.5%** (+1.15倍)

#### Phase 3: P2优化与提取逻辑诊断 (v0.1.6)
- [x] 调整 Rule 3.5 约束（f2_score: 0.80→0.75, f1上界: 0.60→0.65）
- [x] OCR 归一化补充（"工理"→"工程"）
- [x] 目标测试策略验证（节省 12-15 小时）
- [x] **发现关键问题**: 50% 失败案例源于提取逻辑错误
- [x] 发布 v0.1.6

**实际成果** (完整测试):
- Exact: 70 → **71** (+1, +1.4%)
- Review: 25 → **25** (0, 0%)
- Fail: 127 → **126** (-1, -0.8%)
- **自动通过率**: 31.5% → **32.0%** (+0.5%)
- **测试耗时**: 36.6 分钟
- **关键发现**: 提取逻辑错误影响 21 个案例（预期修复后 +5-7% 自动通过率）

---

### 🔥 进行中

#### Phase 4: 提取逻辑修复 (v0.1.7) - **当前阶段** 🔥

**版本状态**: 规划已提交，代码实施中

**P0 级任务（v0.1.7 核心任务）**：
- [x] 清理 label_alias.json 配置污染
- [x] 修复标签匹配子串误匹配（添加分隔符检查）
- [x] 实施跨字段标签排除机制
- [x] 移除续行拼接的 endsWithEntity 误判
- [ ] 运行完整测试（222 样本）
- [ ] 创建实测报告

**预期成果**: 自动通过率 32.0% → **35-37%** (+3-5%)

**P1 级任务（延后到 v0.1.8）**：
- [ ] 在 `domain.json` 中添加 `document_field_labels`
- [ ] 调整提取逻辑，加入文档字段标签排除
- [ ] 完整测试验证

**延后原因**: 需要先验证 v0.1.7 的修复效果，根据实测结果决定 document_field_labels 的具体内容

**预期成果（v0.1.8）**: 自动通过率 35-37% → **37-39%** (+2%)

---

### 📋 待完成

#### Phase 5: 长期优化 (v0.2.0+)
- [ ] 多sheet Excel完整支持
- [ ] review.html单页审查器
- [ ] results_top3.csv输出
- [ ] 配置训练工具

---

## 🔍 关键技术决策

### 已解决的设计缺陷

#### 1. 分桶逻辑规则顺序错误（v0.1.4修复）
**问题**: delta检查在autoPass检查之前，导致80个高质量匹配被误判为review

**修复**: 添加高置信度旁路（规则4）
```typescript
if (top1.score >= 0.90 && top1.f1_score >= 0.80 && top1.f2_score >= 0.80) {
  return { bucket: 'exact', reason: null };
}
```

**影响**: 救回53个案例，自动通过率 3.6% → 27.5%

---

### 待解决的核心问题

#### 1. "项目匹配但供应商不匹配"（P1 - 高价值）
**问题**: 同一项目由多个供应商供货时，当前策略过于严格

**示例**:
```
q_supplier: "宝辉线缆集团有限公司"
q_project:  "武汉三镇中心置业有限公司新建项目" ✅

DB候选:
cand_f1: "泰亿达科技集团有限公司" ❌ (不同供应商)
cand_f2: "武汉三镇中心置业有限公司新建项目新配套工程" ✅
f2_score: 0.8310 ✅ (高！)
→ 结果: Fail (FIELD_SIM_LOW_SUPPLIER)
```

**影响**: 42个案例中约21个 (50%) 可被救回

**计划**: v0.1.5实施"项目优先"策略

---

#### 2. DELTA_TOO_SMALL边界案例（P1 - 中价值）
**问题**: 细微差异导致f2_score未达高置信度阈值

**示例**:
```
q_project: "古田一路北段（长康路-金湖南街）洛线10KV..."
DB候选:  "古田一路北段（长康路-金银湖南街）沿线10kv..."
                              ^^^^^^^^           ^^
f2_score: 0.7549 ⚠️ (< 0.80)
score: 0.8775 ⚠️ (< 0.90)
→ 结果: Review (DELTA_TOO_SMALL)
```

**影响**: 27个残留案例中约15个 (55%) 可被救回

**计划**: v0.1.5降低f2_score阈值至0.75

---

## 📁 文档导航

### 主控文档
- **[项目状态](PROJECT_STATUS.md)** ← 你在这里
- [实施记录](implementation_record.md) - 完整版本历史

### 详细分析报告（按版本）

#### v0.1.4 (当前版本)
- [P0-Fix 报告](../analysis/v0.1.4/P0_fix_report.md) - 高置信度旁路效果验证
- [深度失败分析](../analysis/v0.1.4/deep_failure_analysis.md) - 7个典型案例剖析
- [DB覆盖率验证](../analysis/v0.1.4/db_coverage_verification.md) - 多文件DB流程验证
- [Excel多Sheet处理](../analysis/v0.1.4/excel_multisheet_handling.md) - 技术说明

#### v0.1.5 (计划中)
- [v0.1.5 实施计划](../analysis/current/v0.1.5_plan.md) - P1优化详细方案

#### 归档文档
- [v0.1.3 优化路线图](../analysis/archived/optimization_roadmap.md) - 已过时，被深度失败分析取代
- [v0.1.3 失败分析](../analysis/archived/failure_analysis_report.md) - 已过时，被深度失败分析取代

---

## 🎯 优先级定义

| 优先级 | 定义 | 预期ROI | 实施时间 |
|--------|------|---------|---------|
| **P0** | 紧急修复，阻塞发布 | N/A | 立即 |
| **P1** | 高价值快赢，显著提升KPI | > 20个案例 | 1-2天 |
| **P2** | 中等价值，改善质量 | 6-10个案例 | 3-5天 |
| **P3** | 长期优化，基础设施 | 间接收益 | 1-2周 |

---

## 🚀 快速开始（新Session）

如果context被compact或新开session，按以下步骤恢复：

### 1. 读取当前状态
```bash
cat docs/PROJECT_STATUS.md
```

### 2. 定位当前版本
查看"🗺️ 项目路线图" → "🔥 进行中"

### 3. 读取详细计划
```bash
cat analysis/current/v0.1.5_plan.md
```

### 4. 检查最新代码
```bash
git log --oneline -3
git diff HEAD~1 packages/ocr-match-core/src/bucket/bucketize.ts
```

---

## 📞 关键联系人

- **项目负责人**: Caron
- **技术实施**: Claude Code (Linus Mode)

---

**下一步行动**: 实施v0.1.5 P1优化（预计2天）
