# OCR Match Core å®æ–½è®°å½•

<!-- âš ï¸ AUTOGENERATED SECTION - DO NOT EDIT MANUALLY -->
<!-- ç‰ˆæœ¬æ¡ç›®ç”± `npm run update-docs` è‡ªåŠ¨ç”Ÿæˆå’Œè¿½åŠ  -->
<!-- æ‰‹å·¥ç¼–è¾‘çš„å†…å®¹è¯·åœ¨ç‰ˆæœ¬æ¡ç›®ä¹‹å¤–æ·»åŠ  -->

## ğŸ”— å¿«é€Ÿå¯¼èˆª

### æœ€æ–°ç‰ˆæœ¬
- **[v0.1.6](../analysis/v0.1.6/v0.1.6_å®æµ‹æŠ¥å‘Š.md)** (2025-11-13) - Rule 3.5è°ƒæ•´+æå–é€»è¾‘è¯Šæ–­

### é‡è¦ç‰ˆæœ¬
- **[v0.1.6](../analysis/v0.1.6/v0.1.6_å®æµ‹æŠ¥å‘Š.md)** (2025-11-13) - 32.0% è‡ªåŠ¨é€šè¿‡ç‡ï¼Œå‘ç°P0çº§æå–é€»è¾‘é—®é¢˜
- **[v0.1.5](../analysis/v0.1.5/v0.1.5_å®æµ‹æŠ¥å‘Š.md)** (2025-11-13) - 31.5% è‡ªåŠ¨é€šè¿‡ç‡ï¼Œé¡¹ç›®ä¼˜å…ˆç­–ç•¥
- **[v0.1.7-failure](../analysis/v0.1.7/v0.1.7_failure_analysis.md)** (2025-11-14) - âŒ ç¾éš¾æ€§å›å½’ï¼Œå·²å›æ»š

### æŠ€æœ¯äº®ç‚¹
- **v0.1.4** - åˆ†æ¡¶é€»è¾‘è®¾è®¡ç¼ºé™·ä¿®å¤ â†’ è‡ªåŠ¨é€šè¿‡ç‡ 3.6% â†’ 27.5%
- **v0.1.5** - é¡¹ç›®ä¼˜å…ˆç­–ç•¥ â†’ è‡ªåŠ¨é€šè¿‡ç‡ +4.0%
- **v0.1.6** - æå–é€»è¾‘è¯Šæ–­ â†’ å‘ç°50%å¤±è´¥æ¡ˆä¾‹çš„æ ¹æº

## ğŸ“– FAQ

<details>
<summary><strong>Q: å¦‚ä½•æŸ¥æ‰¾ç‰¹å®šç‰ˆæœ¬çš„æŠ€æœ¯ç»†èŠ‚ï¼Ÿ</strong></summary>

ä½¿ç”¨ Ctrl+F æœç´¢ç‰ˆæœ¬å·ï¼ˆå¦‚"v0.1.6"ï¼‰ï¼Œæˆ–æŸ¥çœ‹ä¸Šè¿°å¿«é€Ÿå¯¼èˆªé“¾æ¥ã€‚
</details>

<details>
<summary><strong>Q: å“ªä¸ªç‰ˆæœ¬æ˜¯å½“å‰ç¨³å®šç‰ˆæœ¬ï¼Ÿ</strong></summary>

å½“å‰ç¨³å®šç‰ˆæœ¬æ˜¯ v0.1.6ï¼ˆ2025-11-13ï¼‰ï¼Œè‡ªåŠ¨é€šè¿‡ç‡ 32.0%ã€‚
</details>

<details>
<summary><strong>Q: v0.1.7 å‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></summary>

v0.1.7 å°è¯•ä¿®å¤æå–é€»è¾‘ï¼Œä½†å¯¼è‡´ç¾éš¾æ€§å›å½’ï¼ˆè‡ªåŠ¨é€šè¿‡ç‡é™è‡³0%ï¼‰ï¼Œå·²å›æ»šåˆ° v0.1.6ã€‚è¯¦è§ [å¤±è´¥åˆ†ææŠ¥å‘Š](../analysis/v0.1.7/v0.1.7_failure_analysis.md)ã€‚
</details>

<details>
<summary><strong>Q: å¦‚ä½•è¿½è¸ªé¡¹ç›®çš„æ•´ä½“è¿›å±•ï¼Ÿ</strong></summary>

æŸ¥çœ‹ [PROJECT_STATUS.md](PROJECT_STATUS.md) äº†è§£é¡¹ç›®è·¯çº¿å›¾å’Œæ ¸å¿ƒæŒ‡æ ‡ã€‚
</details>

<details>
<summary><strong>Q: åœ¨å“ªé‡Œå¯ä»¥çœ‹åˆ°å®Œæ•´çš„æµ‹è¯•æ•°æ®ï¼Ÿ</strong></summary>

æ¯ä¸ªç‰ˆæœ¬çš„æµ‹è¯•æ•°æ®éƒ½è®°å½•åœ¨å¯¹åº”ç‰ˆæœ¬çš„ç« èŠ‚ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
```
</details>

<details>
<summary><strong>Q: å¦‚ä½•å¿«é€Ÿæ‰¾åˆ°å…³é”®æŠ€æœ¯æ´å¯Ÿï¼Ÿ</strong></summary>

æ¯ä¸ªç‰ˆæœ¬ç« èŠ‚æœ«å°¾éƒ½æœ‰"#### æŠ€æœ¯æ´å¯Ÿ"éƒ¨åˆ†ï¼ŒåŒ…å«å…³é”®å‘ç°å’Œç»éªŒæ•™è®­ã€‚
</details>

<details>
<summary><strong>Q: å“ªäº›æ–‡æ¡£ä¼šè‡ªåŠ¨æ›´æ–°ï¼Ÿ</strong></summary>

implementation_record.md çš„ç‰ˆæœ¬æ¡ç›®ç”± `npm run update-docs` è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»ºã€‚
</details>

---

## ç‰ˆæœ¬å†å²

### v0.2.0 - Hybrid F2 Matching (FAILED) (2025-11-19)

**å®æ–½å†…å®¹**:
- å¼•å…¥ LCS (Longest Common Substring) ç®—æ³•ä¼˜åŒ–é¡¹ç›®åç§°åŒ¹é…ï¼ˆF2ï¼‰
- å®ç° `projectFieldSimilarity()`: æ··åˆç®—æ³• (20% Lev + 40% Jac + 40% LCS)
- ä¿®å¤ `lcsRatio()` å½’ä¸€åŒ–å…¬å¼ï¼šMath.max() â†’ Math.min()ï¼ˆå¥–åŠ±å®Œæ•´å­ä¸²åŒ¹é…ï¼‰
- é›†æˆåˆ° `rank.ts` å’Œ `strategies.ts` çš„ anchor ç­–ç•¥

**ç‰ˆæœ¬å®šä½**: F2 ç®—æ³•ä¼˜åŒ– - å°è¯•çªç ´é¡¹ç›®åç§°åŒ¹é…ç“¶é¢ˆï¼ˆF2 æ¯” F1 ä½ 0.142ï¼‰

**å®é™…æ•ˆæœ**: âŒ **å¤±è´¥ - Exact 56 (-21% vs baseline 71)**

#### æµ‹è¯•ç»“æœå¯¹æ¯”

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------|
| v0.1.8 (baseline) | 71 (32%) | 17 (7.7%) | 134 (60.4%) | 32% | `run_20251118_13_46` |
| v0.2.0 (Math.max) | 49 (22.1%) | 59 (26.6%) | 114 (51.4%) | 22.1% | (first attempt) |
| **v0.2.0 (Math.min)** | **56 (25.2%)** | **40 (18.0%)** | **126 (56.8%)** | **25.2%** | `run_20251119_22_07` |

**å›é€€å¹…åº¦**:
- âŒ Exact -15 (-21% vs baseline)
- âŒ Fail +13 (+11% vs baseline)
- âŒ DELTA_TOO_SMALL æ¿€å¢ +19 (21 â†’ 40)
- âœ… FIELD_SIM_LOW_PROJECT æ”¹å–„ -12 (69 â†’ 57)

#### å¤±è´¥åŸå› åˆ†æ

**æ ¹æœ¬é—®é¢˜**ï¼ˆLinus Five-Layer Analysisï¼‰:

1. **ç®—æ³•è®¾è®¡ç¼ºé™·**:
   - LCS "å®¹å¿å­ä¸²åŒ¹é…" ç‰¹æ€§é™ä½äº† Top-1/Top-2 åŒºåˆ†åº¦
   - Jac + LCS æƒé‡è¿‡é«˜ï¼ˆ0.8ï¼‰ï¼Œå¯¼è‡´ç›¸ä¼¼å€™é€‰åˆ†æ•°æ¥è¿‘
   - Levenshtein æƒé‡è¿‡ä½ï¼ˆ0.2ï¼‰ï¼Œä¸§å¤±å­—ç¬¦çº§åˆ¤åˆ«èƒ½åŠ›

2. **æƒé‡é…ç½®ä¸å½“**:
   - é™ä½ Lev æƒé‡æ˜¯ä¸ºäº†å‡å°‘é•¿åº¦å·®å¼‚æƒ©ç½š
   - ä½†åŒæ—¶é™ä½äº†ç²¾ç¡®åŒ¹é…çš„åˆ¤åˆ«èƒ½åŠ›
   - ç»“æœï¼šF2 æ”¹å–„ï¼ˆFIELD_SIM_LOW_PROJECT -12ï¼‰ï¼Œä½†åˆ¤åˆ«èƒ½åŠ›ä¸‹é™ï¼ˆDELTA_TOO_SMALL +19ï¼‰

3. **æœªè§£å†³æ ¹æœ¬é—®é¢˜**:
   - æ ‡ç‚¹ç¬¦å·æ±¡æŸ“ï¼šå•å¼•å· `''`ã€æ‹¬å· `()` æœªè¢«ç§»é™¤
   - DB æ•°æ®è´¨é‡ï¼šé¢å¤–ä¿¡æ¯ï¼ˆå¦‚"ï¼ˆå…‰è°·Pï¼ˆ2023ï¼‰028åœ°å—ï¼‰"ï¼‰æ‰“æ–­åŒ¹é…
   - OCR æå–ä¸å®Œæ•´ï¼šæ ¹æœ¬é—®é¢˜åœ¨æå–é˜¶æ®µï¼Œç®—æ³•æ— æ³•ä¿®å¤

#### æŠ€æœ¯æ´å¯Ÿ

**ä¸ºä»€ä¹ˆ Math.min() æ¯” Math.max() å¥½ï¼Œä½†ä»ç„¶å¤±è´¥ï¼Ÿ**

```typescript
// Math.max() è¿‡åº¦æƒ©ç½š
lcsRatio("ABC", "ABCDEF") = 3/6 = 0.5 âŒ

// Math.min() å¥–åŠ±å®Œæ•´åŒ¹é…
lcsRatio("ABC", "ABCDEF") = 3/3 = 1.0 âœ…

// ä½† LCS + Jaccard ç»„åˆæƒé‡è¿‡é«˜ (0.8)
// å¯¼è‡´é”™è¯¯ç­”æ¡ˆåˆ†æ•°æ¥è¿‘æ­£ç¡®ç­”æ¡ˆ â†’ DELTA_TOO_SMALL
```

**Linus åˆ¤æ–­**:
> "This is over-engineering. We added O(N*M) complexity for +7 Exact (56 vs 49), but lost -19 due to delta issues. The juice is not worth the squeeze. The real problem is normalization (punctuation) and data quality (DB inconsistency), not the similarity algorithm."

**å¾—åˆ°çš„æ•™è®­**:
1. âœ… **"Good taste" åŸåˆ™**: å¥½ç®—æ³•åº”è¯¥æ¶ˆé™¤ç‰¹æ®Šæƒ…å†µï¼Œè€Œä¸æ˜¯ç”¨å¤æ‚é€»è¾‘å¤„ç†ç‰¹æ®Šæƒ…å†µ
2. âœ… **"Practical, not theoretical" åŸåˆ™**: ç†è®ºä¸Š LCS å®¹å¿å­ä¸²åŒ¹é…ï¼Œä½†å®é™…æ•°æ®ä¸­æ ‡ç‚¹ç¬¦å·ä¼šæ‰“æ–­åŒ¹é…
3. âŒ **è¿å "Never break userspace" åŸåˆ™**: Exact ä¸‹é™ 21% ç­‰åŒäºç ´åç”¨æˆ·ä½“éªŒ

#### ä»£ç å˜æ›´

**æ–‡ä»¶**: `packages/ocr-match-core/src/match/similarity.ts`

**å˜æ›´**:
```typescript
// Line 75-100: æ–°å¢ lcsRatio() å‡½æ•°ï¼ˆLCS Substring ç®—æ³•ï¼‰
export function lcsRatio(s1: string, s2: string): number {
  // O(N*M) åŠ¨æ€è§„åˆ’æ±‚æœ€é•¿å…¬å…±å­ä¸²
  const minPossible = Math.min(len1, len2); // Math.max â†’ Math.min ä¿®å¤
  return maxLen / minPossible;
}

// Line 140-160: æ–°å¢ projectFieldSimilarity() å‡½æ•°
export function projectFieldSimilarity(q: string, f: string): number {
  return 0.2 * lev + 0.4 * jac + 0.4 * lcs; // æ··åˆæƒé‡
}

// Line 199-209: singleFieldScore() æ·»åŠ  isProjectField å‚æ•°
```

**é›†æˆä½ç½®**:
- `rank.ts`: `calculateF2Score()` è°ƒç”¨ `projectFieldSimilarity()`
- `strategies.ts`: `anchorMatch()` ä½¿ç”¨ `singleFieldScore(q2, row.f2, true)`

#### ä¸‹ä¸€æ­¥å»ºè®®

**æ¨èæ–¹æ¡ˆ**: å›æ»š + æ•°æ®é©±åŠ¨é‡æ–°è®¾è®¡

**Phase 1**: ç«‹å³å›æ»š LCS ç®—æ³•ï¼Œæ¢å¤ baseline (Lev 50% + Jac 50%)

**Phase 2**: æ ‡ç‚¹ç¬¦å·ä¿®å¤ï¼ˆå•ç‹¬å®éªŒï¼‰
- æ›´æ–° `normalize.user.json`: æ·»åŠ å•å¼•å· `''`ã€æ‹¬å· `()` ç§»é™¤è§„åˆ™
- è¿è¡Œæµ‹è¯•ï¼Œè¯„ä¼°æ”¶ç›Šï¼ˆé¢„æœŸ +5-10 Exactï¼‰

**Phase 3**: æ¡ˆä¾‹ç ”ç©¶ï¼ˆå¿…åšï¼‰
- è¯»å– Top 10 å¤±è´¥æ¡ˆä¾‹çš„å®é™… OCR/DB æ–‡æœ¬
- æ‰‹å·¥åˆ†æä¸ºä»€ä¹ˆåŒ¹é…å¤±è´¥
- åŸºäºçœŸå®æ¡ˆä¾‹è®¾è®¡ç®—æ³•æ”¹è¿›

**Phase 4**: é‡æ–°è¯„ä¼° +28 Exact ç›®æ ‡å¯è¡Œæ€§

**æ–‡æ¡£**: è¯¦è§ [v0.2.0 Failure Analysis](./.spec-workflow/specs/v0.1.9-dynamic-threshold/v0.2.0_failure_analysis.md)

---

### v0.1.8 - Supplier-Threshold Code Salvage (2025-11-18)

**å®æ–½å†…å®¹**:
- ä»å¤±è´¥çš„ v0.1.7 ä¸­æå– supplier-threshold ä¼˜åŒ–ä»£ç  (commit 852050be)
- ä¿ç•™ v0.1.6 ç¨³å®šçš„ extraction logic (201è¡Œ, æ— ä¿®æ”¹)
- å¼•å…¥ SUPPLIER_HARD_REJECT æœºåˆ¶ (supplierHardMin=0.58)
- å®ç° supplier-weighted scoring [0.7, 0.3]
- ä½¿ç”¨ v0.1.7b é…ç½® (bucketize.json + domain fields)

**ç‰ˆæœ¬å®šä½**: ä»£ç æ‰“æ (Code Salvage) - ä» v0.1.7 ç¾éš¾ä¸­æ¢å¤æœ‰ä»·å€¼çš„supplier-thresholdä¼˜åŒ–

**å®é™…æ•ˆæœ**: Exact **71** (32%), Review **17** (7.7%), Fail **134** (60.4%)

#### ä»£ç å˜æ›´

è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ï¼š[supplier-threshold-fix Implementation Logs](./.spec-workflow/specs/supplier-threshold-fix/)

**æ ¸å¿ƒå˜æ›´æ‘˜è¦**:

1. **bucketize.ts - Supplier Threshold æœºåˆ¶**
   - `applySupplierHardThreshold()` - ç¡¬é˜ˆå€¼æ‹¦æˆª (f1 < 0.58)
   - `calculateWeightedScore()` - åŠ æƒè¯„åˆ† [0.7, 0.3]
   - SUPPLIER_HARD_REJECT å¤±è´¥åŸå› 

2. **é…ç½®æ›´æ–°**
   - ä½¿ç”¨ `configs/v0.1.7b/9d2376d2/bucketize.json` (supplierHardMin=0.58, autoPass=0.75)
   - ä¿ç•™ v0.1.7b domain.json çš„ document_field_labels å’Œ table_header_keywords

3. **ä»£ç å›æ»š**
   - extractor.ts æ¢å¤åˆ° v0.1.6 ç‰ˆæœ¬ (201è¡Œ)
   - ç§»é™¤ v0.1.7 çš„ shouldStopLookup/isTableHeader ç­‰ç ´åæ€§é‡æ„

#### æµ‹è¯•ç»“æœ

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------|
| v0.1.6 | 71 (32%) | 16 (7.2%) | 135 (60.8%) | 32% | `run_20251113_21_51` |
| **v0.1.8** | **71 (32%)** | **17 (7.7%)** | **134 (60.4%)** | **32%** | `run_20251118_13_46` |

**æ”¹å–„æ•ˆæœ**:
- âœ… è‡ªåŠ¨é€šè¿‡ç‡ç»´æŒ 32% (ä¸ v0.1.6 baseline æŒå¹³)
- âœ… Exact æ•°é‡ä¿æŒ 71 (æ— å›å½’)
- âœ… SUPPLIER_HARD_REJECT ç”Ÿæ•ˆ (29æ¬¡, 19.2% of failures)
- âœ… FIELD_SIM_LOW_PROJECT æ¢å¤æ­£å¸¸ (67æ¬¡ vs v0.1.7 çš„145æ¬¡)
- âœ… Weighted scoring [0.7, 0.3] æ­£ç¡®åŠ è½½å¹¶åº”ç”¨

**å¯¹æ¯” v0.1.7 ç¾éš¾**:
- v0.1.7: 14% è‡ªåŠ¨é€šè¿‡ç‡ (31 exact, 145 FIELD_SIM_LOW_PROJECT)
- v0.1.8: 32% è‡ªåŠ¨é€šè¿‡ç‡ (71 exact, 67 FIELD_SIM_LOW_PROJECT) - **å®Œå…¨æ¢å¤**

#### ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æŠ¥å‘Š**: `analysis/v0.1.8/v0.1.8_å®æµ‹æŠ¥å‘Š.md`
- **è¿è¡ŒåŒ…**: `runs/run_20251118_13_46/`
- **è§„æ ¼æ–‡æ¡£**: `.spec-workflow/specs/v0.1.8-supplier-threshold/requirements.md`

#### æŠ€æœ¯æ´å¯Ÿ

**âœ… æˆåŠŸçš„ä»£ç æ‰“æç­–ç•¥**

v0.1.8 è¯æ˜äº† **"å¤–ç§‘æ‰‹æœ¯å¼ä»£ç æå–"** çš„å¯è¡Œæ€§ï¼š
- ä»å¤±è´¥ç‰ˆæœ¬ (v0.1.7, commit 852050be) ä¸­åˆ†ç¦»å‡º supplier-threshold ä¼˜åŒ–ä»£ç 
- ä¸ç¨³å®šçš„ extraction logic (v0.1.6) ç»„åˆ
- ä¿æŒ 32% baseline æ€§èƒ½çš„åŒæ—¶å¼•å…¥æ–°åŠŸèƒ½

**ğŸ”‘ å…³é”®å‘ç°: Supplier-Threshold ç‹¬ç«‹æ€§**

Supplier-threshold æœºåˆ¶åœ¨ bucketize.ts ä¸­å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¾èµ– extraction å®ç°ï¼š
- SUPPLIER_HARD_REJECT åœ¨ 29 ä¸ªæ¡ˆä¾‹ä¸­æˆåŠŸæ‹¦æˆªä½è´¨é‡åŒ¹é… (supplier f1 < 0.58)
- Weighted scoring [0.7, 0.3] ä¼˜å…ˆè€ƒè™‘ä¾›åº”å•†åç§°åŒ¹é…
- è¿™éªŒè¯äº† "ä¾›åº”å•† = å¿…è¦æ¡ä»¶, é¡¹ç›® = è¾…åŠ©éªŒè¯" çš„è®¾è®¡åŸåˆ™

**âš ï¸ Extraction é—®é¢˜ä¾ç„¶å­˜åœ¨**

v0.1.8 ä½¿ç”¨ v0.1.6 extraction logicï¼Œå› æ­¤ä»¥ä¸‹é—®é¢˜æœªè§£å†³ï¼š
- FIELD_SIM_LOW_PROJECT ä»å å¤±è´¥æ¡ˆä¾‹ 44.4% (67/151)
- å¤šè¡Œè¡¨æ ¼å¸ƒå±€è§£æä¸å‡†ç¡® (å‘ä¸ŠæŸ¥æ‰¾ç­–ç•¥è¿‡äºæ¿€è¿›)
- è¿™äº›é—®é¢˜å·²è®°å½•åœ¨ v0.1.9-extraction-fix spec ä¸­

**ğŸ“Š é…ç½®å·®å¼‚å½±å“åˆ†æ**

v0.1.8 ä½¿ç”¨ v0.1.7b config (vs v0.1.6 ä½¿ç”¨ v0.labs config)ï¼š
- æ–°å¢ `document_field_labels` å’Œ `table_header_keywords` å­—æ®µ
- Extraction è¡Œä¸ºç•¥æœ‰ä¸åŒ (ä¾‹: baodingshiwuxingdianqi4100967040.txt æå–åŒ…å«å…¬å¸åå‰ç¼€)
- ä½†æ€»ä½“ KPI ä¿æŒä¸€è‡´ (71 exact, 32% è‡ªåŠ¨é€šè¿‡ç‡)

**ğŸ’¡ ç‰ˆæœ¬å‘å¸ƒç»éªŒæ•™è®­**

1. **å•ä¸€èŒè´£åŸåˆ™**: v0.1.8 åªåšä¸€ä»¶äº‹ (supplier-threshold salvage)ï¼ŒæˆåŠŸ
2. **å›å½’æµ‹è¯•åŸºçº¿**: v0.1.6 çš„ 32% æˆä¸ºé‡è¦çš„å›å½’éªŒè¯é”šç‚¹
3. **ç‰ˆæœ¬å·ç­–ç•¥**: è·³è¿‡ "v0.1.7c"ï¼Œç›´æ¥ä½¿ç”¨ v0.1.8 é¿å…å¿ƒç†è´Ÿæ‹…
4. **é…ç½®ç‰ˆæœ¬åŒ–**: ä¿ç•™ v0.1.7b config (9d2376d2) ä½¿å¾—ä»£ç æ‰“ææˆä¸ºå¯èƒ½

**ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘**

v0.1.8 ä¸º v0.1.9 extraction-fix é“ºå¹³äº†é“è·¯ï¼š
- SUPPLIER_HARD_REJECT å·²åˆ†æµ 29 ä¸ªä½è´¨é‡æ¡ˆä¾‹
- FIELD_SIM_LOW_PROJECT (67 æ¬¡) æˆä¸ºæ¸…æ™°çš„ä¼˜åŒ–ç›®æ ‡
- å¯ä»¥ä¸“æ³¨äºä¿®å¤ extraction logic ä¸­çš„å¤šè¡Œå¸ƒå±€è§£æé—®é¢˜

---

### v0.1.7a - CLI configuration priority fix (2025-11-18)

**å®æ–½å†…å®¹**:
- ä¿®å¤ CLI å‚æ•°ä¸‰å±‚ fallback ä¼˜å…ˆçº§ (CLI â†’ config â†’ default)
- ç§»é™¤ CLI override å‚æ•°çš„ default å€¼ (autoPass/minFieldSim/minDeltaTop/weights)
- åˆ é™¤é‡å¤çš„ weights é€‰é¡¹å®šä¹‰
- ä¿®å¤ TypeScript ç±»å‹æ¨æ–­é—®é¢˜ (æ·»åŠ æ˜¾å¼ç±»å‹æ³¨è§£å’Œç±»å‹æ–­è¨€)
- ä¿®å¤ package.json test:full è„šæœ¬ä¸­çš„å‚æ•°è¦†ç›–é—®é¢˜
- å¢å¼ºå‚æ•°æ¥æºæ—¥å¿— (æ˜¾ç¤º CLI/config/default)

**ç‰ˆæœ¬å®šä½**: åŸºç¡€è®¾æ–½ä¿®å¤,é KPI æ”¹è¿›ç‰ˆæœ¬

**å®é™…æ•ˆæœ**: Exact **31** (14%), Review **2** (0.9%), Fail **189** (85.1%)

#### ä»£ç å˜æ›´

**1. ä¿®å¤ CLI å‚æ•° fallback é“¾** (`packages/ocr-match-core/src/cli/match-ocr.ts:254-292`)

å®ç°ä¸‰å±‚ä¼˜å…ˆçº§: `args.param ?? config.param ?? DEFAULT.param`

```typescript
const bucketConfig: {
  autoPass: number;
  minFieldSim: number;
  // ... å…¶ä»–å­—æ®µ
  weights: [number, number];
} = {
  autoPass: args.autoPass ?? config.bucketize?.autoPass ?? DEFAULT_BUCKET_CONFIG.autoPass,
  // ... å…¶ä»–å‚æ•°ç±»ä¼¼
};
```

**2. ç§»é™¤ CLI å‚æ•°é»˜è®¤å€¼** (`packages/ocr-match-core/src/cli/match-ocr.ts:86-115`)

åˆ é™¤ `.option('autoPass', { default: 0.7 })` ç­‰é»˜è®¤å€¼,ç¡®ä¿åªæœ‰æ˜¾å¼ä¼ å‚æ‰è¦†ç›–é…ç½®ã€‚

**3. ä¿®å¤ test:full è„šæœ¬** (`packages/ocr-match-core/package.json:15`)

åˆ é™¤ `--autoPass 0.7 --minFieldSim 0.6` ç­‰ç¡¬ç¼–ç å‚æ•°,ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚

#### æµ‹è¯•ç»“æœ

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------|
| v0.1.6 | 71 (32%) | 15 (6.8%) | 136 (61.3%) | 32% | `run_sample_*` |
| **v0.1.7a** | **31 (14%)** | **2 (0.9%)** | **189 (85.1%)** | **14%** | `run_20251118_09_24` |

**æ”¹å–„æ•ˆæœ**:
- âœ… CLI å‚æ•°ä¼˜å…ˆçº§å·²ä¿®å¤ (é…ç½®æ­£ç¡®åŠ è½½: autoPass=0.75, weights=[0.7,0.3])
- âŒ KPI æœªæ”¹å–„ (14% vs v0.1.6 32%) - æ ¹æœ¬åŸå› æ˜¯æå–ç®—æ³•ç¼ºé™·,éé…ç½®é—®é¢˜

#### ç›¸å…³æ–‡æ¡£

- **Spec**: `.spec-workflow/specs/v0.1.7a-cli-config-fix/`
- **è¿è¡ŒåŒ…**: `runs/run_20251118_09_24/`

#### æŠ€æœ¯æ´å¯Ÿ

**æ ¸å¿ƒå‘ç°**:
1. **CLI fix æˆåŠŸ**: é…ç½®æ–‡ä»¶æ­£ç¡®åŠ è½½,å‚æ•°æ¥æºæ—¥å¿—æ˜¾ç¤º "(config)"
2. **KPI æ— æ”¹å–„**: 145ä¸ª FIELD_SIM_LOW_PROJECT å¤±è´¥æ˜¯æå–æˆªæ–­å¯¼è‡´ (è§æ¡ˆä¾‹: "å±…ä½" â†’ "ä½")
3. **ç‰ˆæœ¬å®šä½**: è¿™æ˜¯åŸºç¡€è®¾æ–½ä¿®å¤,ä¸ºåç»­ä¼˜åŒ–é“ºè·¯

**ç»éªŒæ•™è®­**:
- âš ï¸ é…ç½®ç³»ç»Ÿä¿®å¤ä¸ç­‰äºä¸šåŠ¡æŒ‡æ ‡æ”¹å–„
- âš ï¸ å¿…é¡»åŒºåˆ†"æŠ€æœ¯å€ºä¿®å¤"å’Œ"åŠŸèƒ½ä¼˜åŒ–"
- âœ… v0.1.7a ä¸ºæ­£ç¡®çš„é…ç½®ç®¡ç†å¥ å®šåŸºç¡€

**ä¸‹ä¸€æ­¥æ–¹å‘**: v0.1.8 éœ€è¦ä¿®å¤ Extract é˜¶æ®µçš„å­—æ®µæå–ç®—æ³• (è¡Œçº§æ‰«æ + æˆªå–ä½ç½®)

---

###  v0.1.6 - P2ä¼˜åŒ–ä¸æå–é€»è¾‘è¯Šæ–­ (2025-11-13)

**å®æ–½å†…å®¹**:
- æ”¾å®½ Rule 3.5 çº¦æŸï¼ˆf2_score: 0.80â†’0.75, f1 ä¸Šç•Œ: 0.60â†’0.65ï¼‰
- OCR å½’ä¸€åŒ–è¡¥å……ï¼ˆ"å·¥ç†"â†’"å·¥ç¨‹"ï¼‰
- å®Œæ•´æµ‹è¯•éªŒè¯ï¼ˆ222 æ ·æœ¬ï¼Œ36.6 åˆ†é’Ÿï¼‰
- **å‘ç°å…³é”®é—®é¢˜**ï¼š50% å¤±è´¥æ¡ˆä¾‹æºäºæå–é€»è¾‘é”™è¯¯

**å®é™…æ•ˆæœ**: Exact **70 â†’ 71** (+1, +1.4%), è‡ªåŠ¨é€šè¿‡ç‡ **31.5% â†’ 32.0%** (+0.5%)

#### ä»£ç å˜æ›´

**1. è°ƒæ•´ Rule 3.5 çº¦æŸ** (`packages/ocr-match-core/src/bucket/bucketize.ts:60`)

æ”¾å®½é˜ˆå€¼ä»¥æ•è·æ›´å¤šè¾¹ç•Œæ¡ˆä¾‹ï¼š

```typescript
// v0.1.5
if (top1.f2_score >= 0.80 && top1.f1_score >= 0.40 && top1.f1_score < 0.60) {
  return { bucket: 'review', reason: FailReason.SUPPLIER_DIFF_SAME_PROJECT };
}

// v0.1.6
// v0.1.6: æ”¾å®½é˜ˆå€¼ä»¥æ•‘å›æ›´å¤šè¾¹ç•Œæ¡ˆä¾‹ï¼ˆf2_score 0.80â†’0.75, f1ä¸Šç•Œ 0.60â†’0.65ï¼‰
if (top1.f2_score >= 0.75 && top1.f1_score >= 0.40 && top1.f1_score < 0.65) {
  return { bucket: 'review', reason: FailReason.SUPPLIER_DIFF_SAME_PROJECT };
}
```

**é˜ˆå€¼å˜æ›´å¯¹æ¯”**:

| å‚æ•° | v0.1.5 | v0.1.6 | è¯´æ˜ |
|------|--------|--------|------|
| `f2_score` | >= 0.80 | >= **0.75** | é™ä½ 0.05ï¼ˆé¡¹ç›®åŒ¹é…åº¦è¦æ±‚æ”¾å®½ï¼‰ |
| `f1_score` ä¸Šç•Œ | < 0.60 | < **0.65** | æé«˜ 0.05ï¼ˆæ‰©å¤§æ•è·èŒƒå›´ï¼‰ |

**2. OCR å½’ä¸€åŒ–è¡¥å……** (`configs/v0.labs/10dae06c/normalize.user.json:98-102`)

```json
{
  "pattern": "å·¥ç†",
  "flags": "g",
  "replace": "å·¥ç¨‹"
}
```

#### æµ‹è¯•ç»“æœï¼ˆå®Œæ•´æµ‹è¯•ï¼‰

**æµ‹è¯•ç­–ç•¥**: å®Œæ•´æµ‹è¯•ï¼ˆ222 æ ·æœ¬ï¼‰+ ç›®æ ‡æµ‹è¯•åˆ†æï¼ˆ22 æ ·æœ¬ï¼‰

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | æµ‹è¯•è€—æ—¶ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------|---------|
| v0.1.5 | 70 (31.5%) | 25 (11.3%) | 127 (57.2%) | 31.5% | 36.2 min | `run_v0.1.5_fix_20251113_133741` |
| **v0.1.6** | **71 (32.0%)** | **25 (11.3%)** | **126 (56.8%)** | **32.0%** | **36.6 min** | `run_v0.1.6_full_20251113_214123` |

**ç›®æ ‡æµ‹è¯•ç»“æœ** (22 ä¸ª FIELD_SIM_LOW_SUPPLIER æ¡ˆä¾‹, 14.3 åˆ†é’Ÿ):
- Review: 1 (4.5%) - Rule 3.5 æˆåŠŸæ•è· âœ…
- Fail: 21 (95.5%) - æå–é€»è¾‘é”™è¯¯ âŒ

**æ”¹å–„æ•ˆæœ**:
- âœ… Rule 3.5 è°ƒæ•´æŠ€æœ¯ä¸Šæœ‰æ•ˆï¼ˆæ•‘å›å”¯ä¸€ç¬¦åˆæ¡ä»¶çš„æ¡ˆä¾‹ï¼‰
- âœ… è‡ªåŠ¨é€šè¿‡ç‡æå‡ **+0.5%** (31.5% â†’ 32.0%)
- âš ï¸ å½±å“èŒƒå›´æœ‰é™ï¼ˆä»… +1 ä¸ªæ¡ˆä¾‹ï¼‰
- ğŸ”¥ **æ›´é‡è¦å‘ç°**ï¼š21ä¸ªæå–é€»è¾‘é”™è¯¯æ¡ˆä¾‹ï¼ˆé¢„æœŸ +5-7% ä¿®å¤ä»·å€¼ï¼‰

#### å…³é”®æŠ€æœ¯å‘ç° ğŸ”¥

**æå–é€»è¾‘ç¼ºé™·ï¼ˆP0 çº§é—®é¢˜ï¼‰**:

é€šè¿‡ç›®æ ‡æµ‹è¯•æ·±åº¦åˆ†æï¼Œå‘ç° **50% çš„å¤±è´¥æ¡ˆä¾‹æºäºæå–é€»è¾‘é”™è¯¯**ï¼š

| f1_score èŒƒå›´ | æ¡ˆä¾‹æ•° | å æ¯” | è¯Šæ–­ç»“æœ |
|--------------|--------|------|----------|
| **= 0.0** | 11 | 50% | æå–é€»è¾‘ä¸¥é‡é”™è¯¯ |
| **< 0.05** | 16 | 73% | æå–é€»è¾‘é”™è¯¯ |
| **[0.40, 0.65)** | 2 | 9% | Rule 3.5 ç›®æ ‡åŒºé—´ |

**å…¸å‹é”™è¯¯æ¨¡å¼**:
- æ¡ˆä¾‹ï¼š`changjiangdianqi4100904488.txt`
  - OCR åŸæ–‡ï¼š`ä¾›åº”å•†ï¼šé•¿æ±Ÿç”µæ°”é›†å›¢è‚¡ä»½æœ‰é™å…¬å¸ ... å·¥ç¨‹åç§°ï¼š...`
  - å®é™…æå–ï¼š`q_supplier="å·¥ç¨‹"` âŒï¼ˆæå–åˆ°æ ‡ç­¾è€Œéå€¼ï¼ï¼‰
- æ¡ˆä¾‹ï¼š`jubangjituanyouxiangongsi4100961581.txt`
  - OCR åŸæ–‡ï¼š`ä¾›åº”å•†ï¼šå·¨é‚¦é›†å›¢æœ‰é™å…¬å¸ ... å·¥ç¨‹åç§°ï¼š...ç±³ç²®æ‘è¿˜å»ºæˆ¿Aåœ°å—`
  - å®é™…æå–ï¼š`q_supplier="æ‘è¿˜å»ºæˆ¿Aåœ°å—"` âŒï¼ˆæå–åˆ°å·¥ç¨‹åç§°å°¾éƒ¨ï¼ï¼‰

**é—®é¢˜æ ¹æº**: `extract/extractor.ts` çš„è¡Œçº§æ‰«æé€»è¾‘åœ¨å¤„ç†å¤šè¡Œå¸ƒå±€æ—¶é”™è¯¯åˆå¹¶

**é¢„æœŸä»·å€¼**: ä¿®å¤åå¯æ•‘å› 11-16 ä¸ªæ¡ˆä¾‹ï¼ˆ**+5-7% è‡ªåŠ¨é€šè¿‡ç‡**ï¼‰

#### ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æŠ¥å‘Š**: `analysis/v0.1.6/v0.1.6_å®æµ‹æŠ¥å‘Š.md`
- **ç›®æ ‡æµ‹è¯•è¿è¡ŒåŒ…**: `runs/targeted_v0.1.6_test/` (22 æ ·æœ¬, 14.3 åˆ†é’Ÿ)

#### æŠ€æœ¯æ´å¯Ÿ

**1. ç›®æ ‡æµ‹è¯•ç­–ç•¥çš„åˆ›æ–°ä»·å€¼**:
- âœ… èŠ‚çœ 95% æµ‹è¯•æ—¶é—´ï¼ˆ14.3 åˆ†é’Ÿ vs 12-15 å°æ—¶ï¼‰
- âœ… å¿«é€ŸéªŒè¯å‚æ•°è°ƒæ•´æ•ˆæœ
- âœ… æå‰å‘ç°æ›´æ·±å±‚æ¬¡é—®é¢˜ï¼ˆæå–é€»è¾‘ Bugï¼‰

**2. "Release Early, Release Often" å®è·µ**:
- Rule 3.5 è°ƒæ•´è™½ç„¶åªæ•‘å› 1 ä¸ªæ¡ˆä¾‹ï¼Œä½†æŠ€æœ¯ä¸ŠéªŒè¯äº†è®¾è®¡æ€è·¯
- æ›´é‡è¦çš„æ˜¯å‘ç°äº†æå–é€»è¾‘é—®é¢˜ï¼ˆ10 å€ ROI æœºä¼šï¼‰
- å¿«é€Ÿè¿­ä»£èƒœè¿‡è¿½æ±‚å®Œç¾å•æ¬¡å‘å¸ƒ

**3. ä¼˜åŒ–æ–¹å‘è°ƒæ•´**:
- **ä½ ROI**: ç»§ç»­è°ƒæ•´åˆ†æ¡¶å‚æ•°ï¼ˆè¾¹é™…æ”¶ç›Šé€’å‡ï¼‰
- **é«˜ ROI**: ä¿®å¤æå–é€»è¾‘ï¼ˆé¢„æœŸ +5-7% è‡ªåŠ¨é€šè¿‡ç‡ï¼‰

---

### v0.1.5 - P1ä¼˜åŒ–ï¼šé¡¹ç›®ä¼˜å…ˆç­–ç•¥ (2025-11-13)

**å®æ–½å†…å®¹**:
- æ·»åŠ "é¡¹ç›®ä¼˜å…ˆ"ç­–ç•¥ï¼ˆRule 3.5ï¼‰
- é™ä½é«˜ç½®ä¿¡åº¦f2_scoreé˜ˆå€¼ï¼ˆRule 5ï¼‰
- å®ç°è‡ªåŠ¨é€šè¿‡ç‡ **27.5% â†’ 31.5%** (**1.15å€æå‡**)

#### ä»£ç å˜æ›´

**1. æ–°å¢ FailReason** (`packages/ocr-match-core/src/bucket/reasons.ts:19`)

```typescript
export enum FailReason {
  // ... ç°æœ‰åŸå› 

  /** ä¾›åº”å•†ä¸åŒä½†é¡¹ç›®é«˜åº¦åŒ¹é… */
  SUPPLIER_DIFF_SAME_PROJECT = 'SUPPLIER_DIFF_SAME_PROJECT',
}
```

**2. æ–°å¢è§„åˆ™3.5ï¼ˆé¡¹ç›®ä¼˜å…ˆç­–ç•¥ï¼‰** (`packages/ocr-match-core/src/bucket/bucketize.ts:54-61`)

åœ¨è§„åˆ™3ä¹‹åæ·»åŠ ï¼Œæ•è·é¡¹ç›®é«˜åº¦åŒ¹é…ä½†ä¾›åº”å•†æœ‰å·®å¼‚çš„è¾¹ç•Œæ¡ˆä¾‹ï¼š

```typescript
// è§„åˆ™3.5: é¡¹ç›®é«˜åº¦åŒ¹é…ï¼Œä¾›åº”å•†å¯æ”¾å®½ â†’ review
// "é¡¹ç›®ä¼˜å…ˆ"ç­–ç•¥ï¼šåŒä¸€é¡¹ç›®å¯èƒ½ç”±å¤šä¸ªä¾›åº”å•†åˆ†æ‰¹ä¾›è´§
// å½“é¡¹ç›®åŒ¹é…åº¦å¾ˆé«˜æ—¶ï¼Œå…è®¸ä¾›åº”å•†æœ‰å·®å¼‚ï¼Œäº¤ç”±äººå·¥å®¡æ ¸
// âš ï¸ å…³é”®ï¼šåªæ•è·f1_scoreåœ¨[0.40, 0.60)åŒºé—´çš„è¾¹ç•Œæ¡ˆä¾‹
// f1_score >= 0.60çš„æ¡ˆä¾‹ç»§ç»­å‘ä¸‹ï¼Œå¯èƒ½è¿›å…¥é«˜ç½®ä¿¡åº¦æ—è·¯æˆ–è‡ªåŠ¨é€šè¿‡
if (top1.f2_score >= 0.80 && top1.f1_score >= 0.40 && top1.f1_score < 0.60) {
  return { bucket: 'review', reason: FailReason.SUPPLIER_DIFF_SAME_PROJECT };
}
```

**3. è°ƒæ•´è§„åˆ™5ï¼ˆé«˜ç½®ä¿¡åº¦æ—è·¯é˜ˆå€¼ï¼‰** (`packages/ocr-match-core/src/bucket/bucketize.ts:71`)

é™ä½é˜ˆå€¼ä»¥æ•‘å›è¾¹ç•Œæ¡ˆä¾‹ï¼š

```typescript
// è§„åˆ™5: é«˜ç½®ä¿¡åº¦æ—è·¯ - æé«˜åˆ†æ•°ç›´æ¥é€šè¿‡ï¼Œå¿½ç•¥ delta
// v0.1.5: é™ä½é˜ˆå€¼ä»¥æ•‘å›è¾¹ç•Œæ¡ˆä¾‹ï¼ˆscore 0.90â†’0.85, f2_score 0.80â†’0.75ï¼‰
if (top1.score >= 0.85 && top1.f1_score >= 0.80 && top1.f2_score >= 0.75) {
  return { bucket: 'exact', reason: null };
}
```

**é˜ˆå€¼å˜æ›´å¯¹æ¯”**:

| å‚æ•° | v0.1.4 | v0.1.5 | è¯´æ˜ |
|------|--------|--------|------|
| `score` | >= 0.90 | >= **0.85** | é™ä½0.05 |
| `f1_score` | >= 0.80 | >= 0.80 | ä¸å˜ |
| `f2_score` | >= 0.80 | >= **0.75** | é™ä½0.05 |

#### æµ‹è¯•ç»“æœ

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------||
| v0.1.4 | 61 (27.5%) | 27 (12.2%) | 134 (60.4%) | 27.5% | `run_p0_fix_20251113_093559` |
| **v0.1.5** | **70 (31.5%)** | 25 (11.3%) | 127 (57.2%) | **31.5%** | `run_v0.1.5_fix_20251113_133741` |

**æ”¹å–„æ•ˆæœ**:
- âœ… **9 ä¸ªæ¡ˆä¾‹è¢«æ•‘å›** (fail/review â†’ exact)
- âœ… **è‡ªåŠ¨é€šè¿‡ç‡**: 27.5% â†’ **31.5%** (**+4.0%**, **1.15å€**)
- âœ… **FIELD_SIM_LOW_SUPPLIER**: 42 â†’ 22 (-20, **-47.6%**)
- âœ… **DELTA_TOO_SMALL**: 27 â†’ 18 (-9, **-33.3%**)
- ğŸ†• **SUPPLIER_DIFF_SAME_PROJECT**: 7ä¸ªæ–°å¢æ¡ˆä¾‹

**å¤±è´¥åŸå› åˆ†å¸ƒå˜åŒ–**:
- FIELD_SIM_LOW_PROJECT: 54 â†’ 67 (+13, +24.1%) âš ï¸
- FIELD_SIM_LOW_SUPPLIER: 42 â†’ 22 (-20, -47.6%) âœ…
- DELTA_TOO_SMALL: 27 â†’ 18 (-9, -33.3%) âœ…

#### å®æ–½è¿‡ç¨‹ä¸­çš„Bug

**Bug**: Rule 3.5 åˆå§‹å®ç°ç¼ºå°‘ä¸Šç•Œçº¦æŸ

**é”™è¯¯ä»£ç ** (v0.1.5 é¦–æ¬¡æµ‹è¯•):
```typescript
if (top1.f2_score >= 0.80 && top1.f1_score >= 0.40) {
  return { bucket: 'review', reason: FailReason.SUPPLIER_DIFF_SAME_PROJECT };
}
```

**é—®é¢˜**: æ•è·äº†æ‰€æœ‰ `f1_score >= 0.40` çš„æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬é«˜è´¨é‡åŒ¹é…ï¼Œå¯¼è‡´ï¼š
- Exact: 61 â†’ 9 (æš´è·Œ85.2%)
- Review: 27 â†’ 86 (æš´æ¶¨218.5%)

**ä¿®å¤**: æ·»åŠ ä¸Šç•Œçº¦æŸ `&& top1.f1_score < 0.60`

#### ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æŠ¥å‘Š**: `analysis/v0.1.5/v0.1.5_å®æµ‹æŠ¥å‘Š.md`
- **å®æ–½è®¡åˆ’**: `analysis/v0.1.5/plan.md`
- **è¿è¡ŒåŒ…**: `runs/run_v0.1.5_fix_20251113_133741/`

#### æŠ€æœ¯æ´å¯Ÿ

**ä¸ºä»€ä¹ˆæ–°ç­–ç•¥æ•è·æ¡ˆä¾‹ä½äºé¢„æœŸï¼Ÿ**
- **é¢„æœŸ**: 21ä¸ª SUPPLIER_DIFF_SAME_PROJECT æ¡ˆä¾‹
- **å®é™…**: 7ä¸ªæ¡ˆä¾‹ (ä»…33%)
- **åŸå› **: Rule 3.5 çº¦æŸæ¡ä»¶è¿‡äºä¸¥æ ¼ï¼ˆ`f2_score >= 0.80 && f1_score âˆˆ [0.40, 0.60)`ï¼‰
- **æœªæ¥ä¼˜åŒ–**: v0.1.6 å¯è€ƒè™‘æ”¾å®½çº¦æŸï¼ˆé™ä½f2_scoreè‡³0.75ï¼Œæé«˜f1_scoreä¸Šç•Œè‡³0.65ï¼‰

**FIELD_SIM_LOW_PROJECT æ„å¤–å¢åŠ çš„åŸå› **:
- è§„åˆ™é¡ºåºè°ƒæ•´åï¼Œä¸€äº›åŸæœ¬è¢« Rule 4 (FIELD_SIM_LOW_SUPPLIER) æ•è·çš„æ¡ˆä¾‹
- ç°åœ¨è¢« Rule 3 (FIELD_SIM_LOW_PROJECT) æå‰æ‹¦æˆª
- éœ€è¦è¿›ä¸€æ­¥åˆ†æè¿™13ä¸ªæ–°å¢æ¡ˆä¾‹

---

### v0.1.4 - P0-Fix: é«˜ç½®ä¿¡åº¦æ—è·¯ (2025-11-13)

**å®æ–½å†…å®¹**:
- ä¿®å¤åˆ†æ¡¶é€»è¾‘è®¾è®¡ç¼ºé™·ï¼ˆé«˜ç½®ä¿¡åº¦æ—è·¯ï¼‰
- è§£å†³ P0-2 æ— æ•ˆçš„æ ¹æœ¬åŸå› 
- å®ç°è‡ªåŠ¨é€šè¿‡ç‡ **3.6% â†’ 27.5%** (**7.6å€æå‡**)

#### ä»£ç å˜æ›´

**1. ä¿®å¤ `bucketize.ts` åˆ†æ¡¶é€»è¾‘** (`packages/ocr-match-core/src/bucket/bucketize.ts:57-61`)

æ–°å¢è§„åˆ™4ï¼ˆé«˜ç½®ä¿¡åº¦æ—è·¯ï¼‰ï¼Œåœ¨ delta æ£€æŸ¥ä¹‹å‰æ‹¦æˆªé«˜è´¨é‡åŒ¹é…ï¼š

```typescript
// è§„åˆ™4: é«˜ç½®ä¿¡åº¦æ—è·¯ - æé«˜åˆ†æ•°ç›´æ¥é€šè¿‡ï¼Œå¿½ç•¥ delta
// ä¿®å¤è®¾è®¡ç¼ºé™·ï¼šé¿å…é«˜è´¨é‡åŒ¹é…è¢« delta æ£€æŸ¥è¯¯åˆ¤ä¸º review
if (top1.score >= 0.90 && top1.f1_score >= 0.80 && top1.f2_score >= 0.80) {
  return { bucket: 'exact', reason: null };
}

// è§„åˆ™5: Top1-Top2 å·®å€¼è¿‡å° â†’ review
if (delta < config.minDeltaTop) {
  return { bucket: 'review', reason: FailReason.DELTA_TOO_SMALL };
}
```

**è®¾è®¡ç¼ºé™·è¯´æ˜**:
- åŸé€»è¾‘ï¼šRule 4 (delta check) åœ¨ Rule 5 (autoPass check) ä¹‹å‰ï¼Œæå‰è¿”å›
- åæœï¼šDELTA_TOO_SMALL æ¡ˆä¾‹æ°¸è¿œæ— æ³•è¢« autoPass æ•‘å›
- ä¿®å¤ï¼šåœ¨ delta æ£€æŸ¥å‰å¢åŠ é«˜ç½®ä¿¡åº¦æ—è·¯ï¼Œç›´æ¥é€šè¿‡é«˜åˆ†æ¡ˆä¾‹

#### æµ‹è¯•ç»“æœ

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------||
| P0-1 Bugfix | 8 (3.6%) | 80 (36.0%) | 134 (60.4%) | 3.6% | `run_p0_1_bugfix_20251113_011205` |
| **P0-Fix** | **61 (27.5%)** | 27 (12.2%) | 134 (60.4%) | **27.5%** | `run_p0_fix_20251113_093559` |

**æ”¹å–„æ•ˆæœ**:
- âœ… **53 ä¸ªé«˜è´¨é‡åŒ¹é…è¢«æ•‘å›** (review â†’ exact)
- âœ… **è‡ªåŠ¨é€šè¿‡ç‡**: 3.6% â†’ **27.5%** (**+23.9%**, **7.6å€**)
- âœ… **DELTA_TOO_SMALL**: 80 â†’ 27 (-53 ä¸ª)
- âœ… è¶…å‡ºé¢„æœŸï¼šé¢„æœŸ 12-16%ï¼Œå®é™… **27.5%**

#### ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æŠ¥å‘Š**: `analysis/P0_fix_report_20251113.md`
- **è¿è¡ŒåŒ…**: `runs/run_p0_fix_20251113_093559/`

#### æŠ€æœ¯æ´å¯Ÿ

**ä¸ºä»€ä¹ˆ P0-2 (é™ä½ minDeltaTop) å®Œå…¨æ— æ•ˆï¼Ÿ**
- åŸè§„åˆ™é¡ºåºï¼šdelta æ£€æŸ¥åœ¨ autoPass æ£€æŸ¥ä¹‹å‰
- å³ä½¿é™ä½ minDeltaTop é˜ˆå€¼ï¼Œé«˜åˆ†æ¡ˆä¾‹ä»è¢« delta æ£€æŸ¥æå‰æ‹¦æˆª
- éœ€è¦ä»£ç çº§ä¿®å¤ï¼Œè€Œä¸æ˜¯å‚æ•°è°ƒæ•´

**é«˜ç½®ä¿¡åº¦æ—è·¯çš„è®¾è®¡ç†å¿µ**:
- **åˆ†æ•° >= 0.90**: ç»¼åˆç›¸ä¼¼åº¦æé«˜
- **å­—æ®µåˆ† >= 0.80**: å•å­—æ®µåŒ¹é…å¯é 
- **é€»è¾‘**: åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶çš„åŒ¹é…ï¼Œå³ä½¿ Top1-Top2 å·®å€¼å°ï¼Œä¹Ÿåº”ç›´æ¥é€šè¿‡
- **æ”¶ç›Š**: æ•‘å› 53 ä¸ªé«˜è´¨é‡åŒ¹é…ï¼Œè‡ªåŠ¨é€šè¿‡ç‡æå‡ 7.6 å€

---

### v0.1.3 - P0 ä¼˜åŒ–ï¼šæ ‡ç‚¹ç¬¦å·å½’ä¸€åŒ– (2025-11-13)

**å®æ–½å†…å®¹**:
- **P0-1**: æ ‡ç‚¹ç¬¦å·å½’ä¸€åŒ– (Normalizer æ¨¡å¼)
- **P0-1 Bugfix**: ä¿®å¤åå¤„ç†æ¸…æ´—çš„åŠè§’å†’å·æ”¯æŒ
- **P0-2**: å°è¯•é™ä½ minDeltaTop é˜ˆå€¼ (å‘ç°è®¾è®¡ç¼ºé™·)

#### ä»£ç å˜æ›´

**1. å¼•å…¥ Normalizer å‡½æ•°æ¨¡å¼** (`packages/ocr-match-core/src/match/`)

åœ¨ç›¸ä¼¼åº¦è®¡ç®—å‰ç»Ÿä¸€åº”ç”¨æ ‡ç‚¹ç¬¦å·å½’ä¸€åŒ–ï¼š

- `similarity.ts`: æ·»åŠ  `Normalizer` ç±»å‹å’Œå¯é€‰ normalizer å‚æ•°
  ```typescript
  export type Normalizer = (text: string) => string;

  export function levenshteinSimilarity(
    s1: string,
    s2: string,
    normalizer?: Normalizer
  ): number
  ```

- `rank.ts`: åœ¨å€™é€‰æ‰“åˆ†æ—¶åº”ç”¨ normalizer
- `strategies.ts`: åœ¨ä¸‰ç§åŒ¹é…ç­–ç•¥ä¸­ä¼ é€’ normalizer
- `match.ts`: åˆ›å»º normalizer é—­åŒ…
  ```typescript
  const normalizer = (text: string) => normalize(text, config.normalize);
  const matchResult = match(cleaned.supplier, cleaned.project, index, 0.6, 3, normalizer);
  ```

**2. ä¿®å¤åå¤„ç†æ¸…æ´— bug** (`match.ts:98-108`)

æ”¯æŒå…¨è§’å’ŒåŠè§’å†’å·çš„ admin prefix æ¸…æ´—ï¼š
```typescript
const adminPrefixes = [
  'é¡¹ç›®ç®¡ç†å•ä½ï¼šå®¢æˆ·æœåŠ¡ä¸­å¿ƒå¸‚åœºåŠå¤§å®¢æˆ·æœåŠ¡å®¤',
  'é¡¹ç›®ç®¡ç†å•ä½:å®¢æˆ·æœåŠ¡ä¸­å¿ƒå¸‚åœºåŠå¤§å®¢æˆ·æœåŠ¡å®¤',  // åŠè§’ç‰ˆæœ¬
  'é¡¹ç›®ç®¡ç†å•ä½ï¼šè¿ç»´æ£€ä¿®éƒ¨å·¥ç¨‹åç§°ï¼š',
  'é¡¹ç›®ç®¡ç†å•ä½:è¿ç»´æ£€ä¿®éƒ¨å·¥ç¨‹åç§°:',              // åŠè§’ç‰ˆæœ¬
  // ...
];
```

**3. é…ç½®ç‰ˆæœ¬æ›´æ–°**

æ–°å»ºé…ç½®ç‰ˆæœ¬ `configs/v0.labs/958582ab/`:
- `normalize.user.json`: æ–°å¢ 9 ä¸ªæ ‡ç‚¹ç¬¦å·å½’ä¸€åŒ–è§„åˆ™
  - `ï¼š` â†’ `:`
  - `ï¼›` â†’ `;`
  - `ï¼ˆ` â†’ `(`
  - `ï¼‰` â†’ `)`
  - `ã€` â†’ `[`
  - `ã€‘` â†’ `]`
  - `"` â†’ `"`
  - `"` â†’ `"`
  - `ã€Šã€‹` â†’ `<>`

#### æµ‹è¯•ç»“æœ

| ç‰ˆæœ¬ | Exact | Review | Fail | è‡ªåŠ¨é€šè¿‡ç‡ | è¿è¡Œ ID |
|------|-------|--------|------|------------|---------|
| Baseline | 8 (3.6%) | 79 (35.6%) | 135 (60.8%) | 3.6% | `run_postprocess_20251112_231036` |
| P0-1 Bugfix | 8 (3.6%) | 80 (36.0%) | 134 (60.4%) | 3.6% | `run_p0_1_bugfix_20251113_011205` |
| P0-2 | 8 (3.6%) | 80 (36.0%) | 134 (60.4%) | 3.6% | `run_p0_2_20251113_024120` |

**P0-1 æ•ˆæœåˆ†æ**:
- âœ… 47 ä¸ªæ–‡ä»¶åˆ†æ•°æ”¹å–„ï¼Œå¹³å‡æå‡ +0.9%
- âœ… 1 ä¸ªæ–‡ä»¶ä» fail â†’ review
- âœ… 3 ä¸ªæ–‡ä»¶è¾¾åˆ°å®Œç¾åŒ¹é… (score = 1.0000)
- âœ… ä¿®å¤äº† 6 ä¸ªåå¤„ç†æ¸…æ´—å›å½’æ¡ˆä¾‹
- âŒ è‡ªåŠ¨é€šè¿‡ç‡æ— æ”¹å–„ (æœªè¾¾æ¡¶ä½è·ƒè¿é˜ˆå€¼)

**P0-2 å¤±æ•ˆåŸå› **:
- âŒ å®Œå…¨æ— æ•ˆï¼Œç»“æœä¸ P0-1 bugfix å®Œå…¨ç›¸åŒ
- ğŸ› **å‘ç°è®¾è®¡ç¼ºé™·**: `bucketize.ts:57-76` è§„åˆ™é¡ºåºé”™è¯¯
  - Rule 4 (delta check) æå‰è¿”å›ï¼Œé˜»æ­¢ Rule 5 (autoPass check) æ‰§è¡Œ
  - å¯¼è‡´ minDeltaTop å‚æ•°è°ƒæ•´æ— æ³•å°† DELTA_TOO_SMALL æ¡ˆä¾‹è½¬ä¸º exact
  - **å½±å“èŒƒå›´**: 80 ä¸ª DELTA_TOO_SMALL æ¡ˆä¾‹ (36.0%)ï¼Œå…¶ä¸­ 28 ä¸ª Top1 >= 0.95

#### ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æŠ¥å‘Š**: `runs/P0_optimization_report_20251113.md`
- **å¤±è´¥åˆ†æ**: `analysis/failure_analysis_report.md`
- **ä¼˜åŒ–è·¯çº¿å›¾**: `analysis/optimization_roadmap.md`

#### ä¸‹ä¸€æ­¥è®¡åˆ’

**å¾…ä¿®å¤**: åˆ†æ¡¶é€»è¾‘è®¾è®¡ç¼ºé™·
- **Option 1**: è°ƒæ•´è§„åˆ™é¡ºåº (å…ˆ autoPassï¼Œå† delta)
- **Option 2**: é«˜ç½®ä¿¡åº¦æ—è·¯ (æ¨è)
  ```typescript
  if (top1.score >= 0.90 && top1.f1_score >= 0.80 && top1.f2_score >= 0.80) {
    return { bucket: 'exact', reason: null };
  }
  ```

**é¢„æœŸæ”¹å–„**: ä¿®å¤åè‡ªåŠ¨é€šè¿‡ç‡ **3.6% â†’ 12-16%** (3-4å€æå‡)

---

### v0.1.2 - å¤šæ–‡ä»¶ DB ç´¢å¼•æ”¯æŒ (2025-11-12)

**å®æ–½å†…å®¹**:
- æ”¯æŒå¤šä¸ª Excel æ–‡ä»¶ä½œä¸º DB è¾“å…¥
- è‡ªåŠ¨åˆå¹¶åˆ—ç»“æ„ï¼ˆå– unionï¼‰
- ç”Ÿæˆç»Ÿä¸€çš„ DB digest

**ä»£ç å˜æ›´**:
- `build-index.ts`: æ”¯æŒ `--db` æŒ‡å‘ç›®å½•æˆ–æ–‡ä»¶
- `manifest.json`: è®°å½• DB fingerprints

**æµ‹è¯•ç»“æœ**:
- âœ… æˆåŠŸåˆå¹¶ `ledger-1.xlsx` å’Œ `ledger-2.xlsx`
- âœ… æ€»è¡Œæ•°ï¼š178,043
- âœ… å”¯ä¸€ supplierï¼š517 ä¸ª
- âœ… å€’æ’è¯æ¡ï¼š13,848 ä¸ª

---

### v0.1.1 - åå¤„ç†å­—æ®µæ¸…æ´— (2025-11-11)

**å®æ–½å†…å®¹**:
- å®ç°åå¤„ç† admin prefix æ¸…æ´—
- æ·»åŠ  `was_cleaned` æ ‡è®°åˆ° `results.csv`

**ä»£ç å˜æ›´**:
- `match.ts`: æ·»åŠ  adminPrefixes æ£€æµ‹å’Œæ¸…æ´—é€»è¾‘
- `results.csv`: æ–°å¢ `was_cleaned` åˆ—

**æµ‹è¯•ç»“æœ**:
- âœ… 29 ä¸ªæ–‡ä»¶è¢«æ¸…æ´—
- âœ… å¹³å‡åˆ†æ•°æå‡ +5.2%
- âœ… 7 ä¸ªæ–‡ä»¶æ¡¶ä½æ”¹å–„

---

### v0.1.0 - æ ¸å¿ƒæµç¨‹å®ç° (2025-11-10)

**å®æ–½å†…å®¹**:
- å®Œæˆå››é˜¶æ®µå¤„ç†ç®¡çº¿ï¼ˆnormalize â†’ extract â†’ match â†’ bucketizeï¼‰
- å®ç°ä¸‰çº§åŒ¹é…ç­–ç•¥ï¼ˆfast-exact â†’ anchor â†’ recall+rankï¼‰
- ç”Ÿæˆè¿è¡ŒåŒ…ç»“æ„ï¼ˆmanifest.json / results.csv / summary.md / log.jsonlï¼‰

**ä»£ç å˜æ›´**:
- `normalize/pipeline.ts`: æ–‡æœ¬å½’ä¸€åŒ–
- `extract/extractor.ts`: å­—æ®µæå–
- `match/strategies.ts`: åŒ¹é…ç­–ç•¥
- `bucket/bucketize.ts`: åˆ†æ¡¶é€»è¾‘
- `report/generator.ts`: æŠ¥å‘Šç”Ÿæˆ

**æµ‹è¯•ç»“æœ**:
- âœ… åŸºç¡€æµç¨‹æ‰“é€š
- âœ… Baseline è‡ªåŠ¨é€šè¿‡ç‡ï¼š3.6%
- âœ… å¹³å‡è€—æ—¶ï¼š8.3s/æ–‡ä»¶

---

## å…³é”®æŒ‡æ ‡æ¼”è¿›

| ç‰ˆæœ¬ | è‡ªåŠ¨é€šè¿‡ç‡ | å¹³å‡åˆ†æ•° | å¹³å‡è€—æ—¶ | é…ç½®ç‰ˆæœ¬ |
|------|-----------|---------|---------|---------|
| v0.1.0 | 3.6% | 0.6421 | 8.3s | v0.base |
| v0.1.1 | 3.6% | 0.6690 (+4.2%) | 8.3s | v0.postprocess |
| v0.1.2 | 3.6% | 0.6690 | 8.3s | v0.postprocess |
| v0.1.3 | 3.6% | 0.6751 (+0.9%) | 8.3s | v0.labs/958582ab |
| v0.1.4 | 27.5% (+663%) | 0.6751 | 9.7s | v0.labs/958582ab |
| v0.1.5 | 31.5% (+14.5%) | 0.6751 | 9.8s | v0.labs/958582ab |
| **v0.1.6** | **32.0% (+1.6%)** | 0.6751 | 9.9s | v0.labs/10dae06c |

**é‡å¤§çªç ´**:
- v0.1.4 ä¿®å¤åˆ†æ¡¶é€»è¾‘ï¼Œè‡ªåŠ¨é€šè¿‡ç‡æå‡ **7.6 å€**
- v0.1.5 P1ä¼˜åŒ–ï¼Œè‡ªåŠ¨é€šè¿‡ç‡æå‡ **1.15 å€**

---

## æŠ€æœ¯å€ºåŠ¡

### High

1. **ç¼ºå°‘ results_top3.csv**
   - å½±å“ï¼šæ— æ³•åˆ†æ Top3 å€™é€‰åˆ†æ•°åˆ†å¸ƒ
   - ä¿®å¤æ–¹æ¡ˆï¼šåœ¨ `report/generator.ts` ä¸­æ·»åŠ  Top3 è¾“å‡º
   - ä¼˜å…ˆçº§ï¼šP1

2. **ç¼ºå°‘ review.html å•é¡µå®¡æŸ¥å™¨**
   - å½±å“ï¼šæ— æ³•å¿«é€Ÿäººå·¥å®¡æ ¸
   - ä¿®å¤æ–¹æ¡ˆï¼šå®ç°å‰ç«¯å•é¡µåº”ç”¨
   - ä¼˜å…ˆçº§ï¼šP1

---

**æœ€åæ›´æ–°**: 2025-11-13 10:15
